---
name: Написать код, который будет выводить коды ответов на HTTP-запросы
module: Практика
tags:
  - avito
  - easy
---

- Написать код, который будет выводить коды ответов на HTTP-запросы по двум URL адресам (например главная страница Google и главная страница Avito).
- Запросы должны осуществляться параллельно.

Что проверяем:

- Базовое знание горутин.
- Знание примитивов синхронизации
- Понимание работы context
- Паттерны межсервисного взаимодействия

```go
package main

import (
	"fmt"
	"net/http"

	"golang.org/x/sync/errgroup"
)

var urls = []string{"https://google.com", "https://avito.ru"}

func main() {
	var wg errgroup.Group
	result := make(chan string, len(urls))
	for _, url := range urls {
		wg.Go(func() error {
			res, err := http.Get(url)
			if err != nil {
				return err
			}
			result <- fmt.Sprintf("url: %s, status code: %d", url, res.StatusCode)
			return nil
		})
	}
	err := wg.Wait()
	close(result)
	if err != nil {
		fmt.Printf("Got the error: %s\n", err)
		return
	}
	for str := range result {
		fmt.Println(str)
	}
}
```

1. Шедулинг горутин, преимущества горутин (что такое горутины в Go и как они соотносятся с потоками операционной системы)
2. А если URL адресов будет 500 и запустить запросы по ним в 500 горутинах, будут и все они выполняться одновременно? Как это устроено “под капотом”?
3. Как изменить этот код чтобы можно было передавать любое количество URL адресов?
4. Как изменить этот код чтобы максимальное время его выполнения было 2 секунды?
5. Advanced: Как изменить код, если мы захотим сделать утилиту демоном, который умеет безопасно завершаться (graceful shutdown). Ожидаем рассказ про обработку сигналов.
6. Expert: Как можно оптимизировать создание TCP-соединений в HTTP/1.1? ||(ожидаем ответ про keep-alive)||
7. Как можно управлять keep-alive в HTTP-клиенте go? ||(ожидаем, что скажет про пул соединений, MaxIdleConns, IdleConnTimeout)||
8. Для чего управлять пулом? ||(контроль нагрузки на сервис, к которому обращаемся)||
9. Expert: Как в Linux понять, сколько у процесса открытых соединений?
10. Приходилось ли дебажить на таком уровне? ||(Ожидаем, что расскажет про `lsof`, `netstat` или `ss`)||
11. Expert: Какие проблемы нужно учесть при запросах к удаленным серверам? ||(Могут быть проблемы недоступности, приемлемым решением было бы использование паттерна Circuit breaker)||