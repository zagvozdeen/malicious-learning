---
name: Задача на сетевые запросы
module: Практика
tags:
  - avito
  - easy
---

Что выведет следующая программа и сколько она будет выполняться по времени?

```go
package main

import (
	"fmt"
	"time"
)

const numRequests = 10000

var count int

func networkRequest() {
	time.Sleep(time.Millisecond) // Эмуляция сетевого запроса.
	count++
}

func main() {
	for i := 0; i < numRequests; i++ {
		networkRequest()
	}
	fmt.Println(count)
}
```

Ответ: ||10000 и около 10 секунд||

Как ускорить выполнение этой задачи? Что проверяем:

- Общее понимание CPU и IO-bound задач
- Базовое знание горутин
- Знание примитивов синхронизации

Примечание:

- ||Кандидат добавляет `go networkRequest()`||
- ||Кандидат добавляет `sync.WaitGroup`||
- ||Кандидат защищает count локом из пакета sync (или использовать пакет sync/atomic)||
- Какие преимущества работы с atomic над mutex? ||(рассказывает про специальные инструкции процессоров и преимущества над мютексами)||
- Спрашиваем за сколько по его мнению отработает программа теперь? ||(1-2ms норм ответ)||
- А что если это настоящий сетевой запрос, не столкнемся ли мы с какой-нибудь проблемой на практике? ||(лимит файловых дескрипторов)||