---
name: Задачка про датафикс
module: Базы данных
tags:
  - грейды
---
Есть таблица на 1 миллиард записей, которая активно используется в продашкне. Нужно
сделать датафикс, который модифицирует 10 миллионов строк. Как бы ты подошел к
решению задачи?

**18 грейд**

Делал бы update батчами, с фильтром по индексируемым полям.

**19 грейд**

Из жизни — чаще всего надо поправить только ряды за сегодня, а на остальное забить, это
сразу переводит задачу в класс более простых. То есть есть какой-то соседний индекс коррелирующий с появлением испорченных записей, и по этому индексу можно радикально сократить кол-во перебираемых рядов.

Если же реально данные равномерно размазаны по всей таблице:

**Первое.** Если индекс, позволяющий найти нужны ряды есть — все проще, пишем код, который отдельно набирает ID рядов, где условие выполняется, потом накатываем изменения пачками с `where ID in(...)`.

**Второе.** Если индекса по нужному нам условию нет, и надо перебирать все поля
• выбираем ID начиная от которого баг исправлен
• далее пишем скрипт который читает кусками данные из слейва и сохраняет в файл ID рядов где надо менять данные
• накатываем пачками на мастер по 1000-10 000 рядов, беря ID из файла
