---
name: Как спроектировать Rate limit?
module: Архитектура
tags:
  - грейды
  - озон
---
Мой сервис используют внешний API для построения маршрутов, в рамках тарифа у нас
есть ограничение по RPS. Нужно спроектировать ratelimiter.

**18 грейд**

Есть два основных варианта решения этой задачи:

• С использованием внешнего хранилища. Например, мы можем использовать redis для этой задачи, в котором храним в счетчике кол-во запросов за нужное окно.
• Без использования внешнего хранилища. Каждый инстанс имеет ограничение x / n , где x - общее количество запросов, а n - количество инстансов.

Q: Какие есть плюсы и минусы у одной/обоих схем?
A: Внешнее хранилище, плюсы:

• простая реализация и конфигурация
• не имеет значения насколько сбалансированы запросы по инстансам сервиса минусы:
• увеличение времени запроса
• единая точка отказа

Без внешнего хранилища, плюсы:

• нет единой точки отказа
• нету дополнительных задержек

Минусы:

• сложно конфигурировать
• балансировка запросов имеет большое значение

**19 грейд**

Q Как можно оптимизировать работу с redis'ом?
A: Использовать lua и сделать процедуру, которая будет возвращать true/false.
