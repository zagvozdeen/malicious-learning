---
name: Что такое defer?
module: Теория
tags:
  - грейды
---

```go
package main

import "fmt"

type X struct {
	V int
}

func (x X) S() {
	fmt.Println(x.V)
}
func main() {
	x := X{123}
	defer x.S()
	x.V = 456
}
```

После ответа - спросить, что изменится, если изменить код:

```go
package main

import "fmt"

type X struct {
	V int
}

func (x X) S() {
	fmt.Println(x.V)
}
func main() {
	x := X{123}
	defer func() { x.S() }()
	x.V = 456
}
```

**17 грейд**

Defer гарантирует отложенный вызов функциии по мере выполнения программы. Defer добавляет функцию в стек вызова приложения.
В первом случае ответ: 123, во втором - 456 (передача по ссылке)

**18 грейд**

Q: Что произойдет, если писать несколько `defer` подряд?
A: Они вызовутся в обратном порядке, так как это стек вызова функций.

Q: В каких случаях `defer` вызван не будет?
A: `os.Exit()`, паника, `log.Fatal()` (внутри вызывает `os.Exit()`)
