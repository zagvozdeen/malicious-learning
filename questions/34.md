---
question: 'IsolationForest: как строятся деревья для поиска аномалий?'
module: Теория
---

Isolation Forest строит специальные деревья таким образом, чтобы "случайно" изолировать каждую точку. Процесс для каждого дерева выглядит так:

1. Выбирается случайно признак и на нём случайно выбирается порог (между мин и макс значением этого признака у текущих точек).

2. Данные разделяются этим порогом на две части – те, у которых значение признака меньше порога и больше (как обычное бинарное разделение в дереве).

3. Затем для каждой получившейся части рекурсивно повторяется процесс: снова случайно выбирается признак и порог, и выполняется разделение.

4. Дерево растёт до тех пор, пока в узле не останется одна точка (она изолирована) или пока не достигнута максимальная глубина.

Несколько таких случайных деревьев (лес) образуют модель. Идея в том, что аномальные точки обычно находятся "особняком" – у них какие-то уникальные, экстремальные значения признаков. Поэтому случайное разделение пространства вероятнее очень быстро отсечёт такую точку от остальных. Она попадёт в отдельный узел спустя мало разбиений (короткий путь в дереве). А вот нормальные объекты, которые сконцентрированы в массовых кластерах, будут отделяться от других постепенно, им потребуется больше случайных разбиений, то есть у них длина пути до изоляции будет больше. Так и строятся деревья Isolation Forest: без какого-либо критерия информативности, чисто случайно разрезая пространство признаков, что в среднем сильно изолирует выбросы раньше остальных.

